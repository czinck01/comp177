<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Income Tax History</title>
    <style>
        body {
            background-color:coral;
            text-align: center;
        }
        h1 {
            color: white;
            margin-bottom: -20px;
        }

        h3 {
            color: white;
            margin-bottom: -20px;
        }
    
        svg {
            display: block;
            margin: auto;
            margin-top: 50px;
            margin-bottom: 50px
        }
        
        button {
            font-size: 50px;
        }
    </style>
</head>
<body>
    <h1></h1></br>
    <h3></h3>
    <svg></svg>
    <button></button>
    <script src="js/d3.v4.min.js"></script>
    <script>
       
        var dim = 900;
 
        var title = d3.select("h1")
        .text("Federal Income Tax Brackets Throughout History");

        var subtitle = d3.select("h3")
        .text("Year:");

        var svg = d3.select('svg')
        .attr('width', dim)
        .attr('height', .5*dim)
        .style('background-color', 'white');    

        var r1 = svg.append("polygon")
            .attr("id", "r1")
            .attr("points", (1*dim/15) + "," + (dim/2) + " " + (1*dim/15) + "," + (dim/2) + " " + (2*dim/15) + "," + (dim/2) + " " + (2*dim/15) + "," + (dim/2));

        var r2 = svg.append("polygon")
            .attr("id", "r2")
            .attr("points", (3*dim/15) + "," + (dim/2) + " " + (3*dim/15) + "," + (dim/2) + " " + (4*dim/15) + "," + (dim/2) + " " + (4*dim/15) + "," + (dim/2));

        var r3 = svg.append("polygon")
            .attr("id", "r3")
            .attr("points", (5*dim/15) + "," + (dim/2) + " " + (5*dim/15) + "," + (dim/2) + " " + (6*dim/15) + "," + (dim/2) + " " + (6*dim/15) + "," + (dim/2));

        var r4 = svg.append("polygon")
            .attr("id", "r4")
            .attr("points", (7*dim/15) + "," + (dim/2) + " " + (7*dim/15) + "," + (dim/2) + " " + (8*dim/15) + "," + (dim/2) + " " + (8*dim/15) + "," + (dim/2));

        var r5 = svg.append("polygon")
            .attr("id", "r5")
            .attr("points", (9*dim/15) + "," + (dim/2) + " " + (9*dim/15) + "," + (dim/2) + " " + (10*dim/15) + "," + (dim/2) + " " + (10*dim/15) + "," + (dim/2));

        var r6 = svg.append("polygon")
            .attr("id", "r6")
            .attr("points", (11*dim/15) + "," + (dim/2) + " " + (11*dim/15) + "," + (dim/2) + " " + (12*dim/15) + "," + (dim/2) + " " + (12*dim/15) + "," + (dim/2));

        var r7 = svg.append("polygon")
            .attr("id", "r7")
            .attr("points", (13*dim/15) + "," + (dim/2) + " " + (13*dim/15) + "," + (dim/2) + " " + (14*dim/15) + "," + (dim/2) + " " + (14*dim/15) + "," + (dim/2));

        var button = d3.select('button')
        .text("Play")
        .attr("onclick", "display();");

        function update(data, i) {
            var d = data[i];
            r1.transition().attr("points", (1*dim/15) + "," + (dim/2) + " " + (1*dim/15) + "," + (dim/2 - (parseInt((d["Single"]).replace(/,/g, ""))/4000)*dim/2) + " " + (2*dim/15) + "," + (dim/2 - (parseInt(d["Single"].replace(/,/g, ""))/4000)*dim/2) + " " + (2*dim/15) + "," + (dim/2) ).duration(500*i);
            r2.transition().attr("points", (3*dim/15) + "," + (dim/2) + " " + (3*dim/15) + "," + (dim/2 - (parseInt(d["Married"].replace(/,/g, ""))/8000)*dim/2) + " " + (4*dim/15) + "," + (dim/2 - (parseInt(d["Married"].replace(/,/g, ""))/8000)*dim/2) + " " + (4*dim/15) + "," + (dim/2) ).duration(500*i);
            r3.transition().attr("points", (5*dim/15) + "," + (dim/2) + " " + (5*dim/15) + "," + (dim/2 - (parseInt(d["Dependent"].replace(/,/g, ""))/4000)*dim/2) + " " + (6*dim/15) + "," + (dim/2 - (parseInt(d["Dependent"].replace(/,/g, ""))/4000)*dim/2) + " " + (6*dim/15) + "," + (dim/2) ).duration(500*i);
            r4.transition().attr("points", (7*dim/15) + "," + (dim/2) + " " + (7*dim/15) + "," + (dim/2 - (parseInt(d["LowRate"].replace(/,/g, ""))/23)*dim/2) + " " + (8*dim/15) + "," + (dim/2 - (parseInt(d["LowRate"].replace(/,/g, ""))/23)*dim/2) + " " + (8*dim/15) + "," + (dim/2) ).duration(500*i);
            r5.transition().attr("points", (9*dim/15) + "," + (dim/2) + " " + (9*dim/15) + "," + (dim/2 - (parseInt(d["Under"].replace(/,/g, ""))/43850)*dim/2) + " " + (10*dim/15) + "," + (dim/2 - (parseInt(d["Under"].replace(/,/g, ""))/43850)*dim/2) + " " + (10*dim/15) + "," + (dim/2) ).duration(500*i);
            r6.transition().attr("points", (11*dim/15) + "," + (dim/2) + " " + (11*dim/15) + "," + (dim/2 - (parseInt(d["HighRate"].replace(/,/g, ""))/94)*dim/2) + " " + (12*dim/15) + "," + (dim/2 - (parseInt(d["HighRate"].replace(/,/g, ""))/94)*dim/2) + " " + (12*dim/15) + "," + (dim/2) ).duration(500*i);
            r7.transition().attr("points", (13*dim/15) + "," + (dim/2) + " " + (13*dim/15) + "," + (dim/2 - (parseInt(d["Over"].replace(/,/g, ""))/5000000)*dim/2) + " " + (14*dim/15) + "," + (dim/2 - (parseInt(d["Over"].replace(/,/g, ""))/5000000)*dim/2) + " " + (14*dim/15) + "," + (dim/2) ).duration(500*i);
        }

        function display() {
            d3.tsv("data/data.tsv", function(data) {
                console.log(data);
                for (var i = 0; i < data.length; i++) {
                    var d = data[i];
                    setTimeout(update, 500, data, i);
                    d3.select("h3").text("Year: " + d["Year"]);
                }

            });
        }

    </script>
</body>
</html>
